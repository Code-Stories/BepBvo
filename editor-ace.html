<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <style type="text/css" media="screen">
    html, body {
        overflow: hidden;
        padding:0;
        margin:0;
    }

    #editor {
        margin: 0;
        position: absolute;
        top: 50px;
        bottom: 0;
        left: 0;
        right: 0;
    }

    nav {
      background-color: #2196F3;
      height: 50px;
    }

    nav ul.controls{
      list-style: none;
      margin:0;
      padding:0;
      height: 100%;
    }

    nav ul.controls li{
      float:left;
      height: 100%;
    }

    nav ul.controls li button{
      background-color: #90CAF9;
      width: 100px;
      height: 100%;
      border: none;
      margin:0;
      color:#FFFFFF;
      font-size: 15px;
      outline:none;
    }

    nav ul.controls li button:active{
      background-color: #1565C0;
    }

    nav ul.controls li button:disabled{
      background-color: #B0BEC5;
    }

  </style>
</head>
<body>

<nav>
  <ul class="controls">
    <li>
      <button  onclick="parseButton()">Parse</button>
    </li>
    <li>
      <button onclick="stepButton()" id="stepButton" disabled="disabled">Step</button>
    </li>
    <li>
      <button onclick="runButton()" id="runButton" disabled="disabled">Run</button>
    </li>
  </ul>
</nav>
<textarea id="code" style="display:none;"></textarea>
<pre id="editor">
var result = [];
function fibonacci(n, output) {
  var a = 1, b = 1, sum;
  for (var i = 0; i &lt; n; i++) {
    output.push(a);
    sum = a + b;
    a = b;
    b = sum;
  }
}
fibonacci(16, result);
alert(result.join(', '));
</pre>




<script src="libs/editor-ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="libs/interpreter/acorn.js"></script>
<script src="libs/interpreter/interpreter.js"></script>
<script>

  var editor = ace.edit("editor");
  editor.getSession().setMode("ace/mode/javascript");
  console.log(editor.getValue());



  var myInterpreter;
  function initAlert(interpreter, scope) {
    var wrapper = function(text) {
      text = text ? text.toString() : '';
      return interpreter.createPrimitive(alert(text));
    };
    interpreter.setProperty(scope, 'alert',
        interpreter.createNativeFunction(wrapper));
  };

  function parseButton() {
    document.getElementById('code').value = editor.getValue();
    var code = document.getElementById('code').value;
    myInterpreter = new Interpreter(code, initAlert);
    disable('');
  }

  function stepButton() {
    var range = {
      start: {
        row: 0,
        column: 0
      },
      end: {
        row: 0,
        column: 0
      }
    }

    if (myInterpreter.stateStack[0]) {
      var node = myInterpreter.stateStack[0].node;
      range.start.row = node.loc.start.line - 1 ;
      range.start.column = node.loc.start.column;
      range.end.row = node.loc.end.line - 1;
      range.end.column = node.loc.end.column;
    } 

    editor.getSession().selection.setSelectionRange(range);
    try {
      var ok = myInterpreter.step();
    } finally {
      if (!ok) {
        disable('disabled');
      }
    }
  }

  function runButton() {
    try {
      myInterpreter.run();
    } finally {
      disable('disabled');
    }
  }

  function disable(disabled) {
    document.getElementById('stepButton').disabled = disabled;
    document.getElementById('runButton').disabled = disabled;
  }

</script>

</body>
</html>
